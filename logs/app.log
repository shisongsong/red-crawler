2024-06-24 09:29:41,708 - INFO - auth:20 - ImmutableMultiDict([])
2024-06-24 09:36:41,765 - INFO - auth:20 - ImmutableMultiDict([])
2024-06-24 09:36:55,138 - INFO - auth:20 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-24 09:37:53,496 - INFO - auth:20 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-24 09:37:53,497 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 21, in register_view
    form = RegistrationForm(request.get_json())
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 208, in __call__
    return type.__call__(cls, *args, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_wtf/form.py", line 73, in __init__
    super().__init__(formdata=formdata, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 286, in __init__
    self.process(formdata, obj, data=data, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 127, in process
    field.process(formdata, data, extra_filters=field_extra_filters)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/fields/core.py", line 327, in process
    self.raw_data = formdata.getlist(self.name)
AttributeError: 'dict' object has no attribute 'getlist'
2024-06-24 09:43:29,620 - INFO - auth:20 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-24 09:43:29,622 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 27, in register_view
    form = RegistrationForm(form_data)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 208, in __call__
    return type.__call__(cls, *args, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_wtf/form.py", line 73, in __init__
    super().__init__(formdata=formdata, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 286, in __init__
    self.process(formdata, obj, data=data, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 127, in process
    field.process(formdata, data, extra_filters=field_extra_filters)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/fields/core.py", line 327, in process
    self.raw_data = formdata.getlist(self.name)
AttributeError: 'dict' object has no attribute 'getlist'
2024-06-24 09:44:42,533 - INFO - auth:26 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-24 09:44:42,534 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 28, in register_view
    form = RegistrationForm(form_data)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 208, in __call__
    return type.__call__(cls, *args, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_wtf/form.py", line 73, in __init__
    super().__init__(formdata=formdata, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 286, in __init__
    self.process(formdata, obj, data=data, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/form.py", line 127, in process
    field.process(formdata, data, extra_filters=field_extra_filters)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/wtforms/fields/core.py", line 327, in process
    self.raw_data = formdata.getlist(self.name)
AttributeError: 'dict' object has no attribute 'getlist'
2024-06-24 09:54:41,230 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-25 03:00:42,787 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-25 03:00:50,295 - ERROR - app:838 - Exception on /api/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/user.py", line 10, in users_view
    return jsonify(users), 201
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type User is not JSON serializable
2024-06-25 03:08:25,582 - ERROR - app:838 - Exception on /api/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 883, in full_dispatch_request
    return self.finalize_request(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 902, in finalize_request
    response = self.make_response(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1193, in make_response
    rv = self.json.response(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type User is not JSON serializable
2024-06-25 03:12:04,312 - ERROR - app:838 - Exception on /api/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/user.py", line 10, in users_view
    users = [jsonify(user) for user in users]
  File "/workspaces/red-crawler/app/views/user.py", line 10, in <listcomp>
    users = [jsonify(user) for user in users]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type User is not JSON serializable
2024-06-25 03:12:54,676 - ERROR - app:838 - Exception on /api/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/user.py", line 10, in users_view
    users = [jsonify(user).data for user in users]
  File "/workspaces/red-crawler/app/views/user.py", line 10, in <listcomp>
    users = [jsonify(user).data for user in users]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/__init__.py", line 170, in jsonify
    return current_app.json.response(*args, **kwargs)  # type: ignore[return-value]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 121, in _default
    raise TypeError(f"Object of type {type(o).__name__} is not JSON serializable")
TypeError: Object of type User is not JSON serializable
2024-06-25 03:15:05,724 - ERROR - app:838 - Exception on /api/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/user.py", line 10, in users_view
    users = json.dumps(get_all())
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '
TypeError: Object of type User is not JSON serializable
2024-06-25 06:08:28,015 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-25 06:09:38,627 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-25 06:25:36,559 - ERROR - app:838 - Exception on /api/users/1 [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/user.py", line 15, in user_view
    user = User.query.first(id = user_id)
TypeError: Query.first() got an unexpected keyword argument 'id'
2024-06-26 06:55:26,113 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-26 06:55:26,125 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such table: user

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 27, in register_view
    if register(form.phone.data, form.password.data):
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 12, in register
    if User.query.filter_by(phone=phone).first():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2728, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2827, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2236, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: user
[SQL: SELECT user.id AS user_id, user.phone AS user_phone, user.password_hash AS user_password_hash, user.role AS user_role, user.deleted AS user_deleted, user.created_at AS user_created_at 
FROM user 
WHERE user.phone = ?
 LIMIT ? OFFSET ?]
[parameters: ('17696021211', 1, 0)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2024-06-26 06:56:44,576 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-26 06:56:48,606 - INFO - auth:24 - {'phone': '17696021211', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-26 06:56:48,608 - ERROR - auth_controller:13 - Phone already exists.
2024-06-26 06:58:05,084 - ERROR - app:838 - Exception on /api/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
TypeError: login_view() got an unexpected keyword argument 'prefix'
2024-06-26 07:46:49,666 - INFO - auth:24 - {'phone': '17696021212', 'password': '11111111', 'confirm_password': '11111111'}
2024-06-27 04:15:38,124 - ERROR - app:838 - Exception on /admin/users/1 [PUT]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: NOT NULL constraint failed: user.role

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/jwt_required.py", line 15, in wrapper
    return fn(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/admin/user.py", line 75, in update_user
    errors = update(user_id, json_data)
  File "/workspaces/red-crawler/app/controllers/admin/user_controller.py", line 28, in update
    db.session.commit()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 597, in commit
    return self._proxied.commit()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2017, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: user.role
[SQL: UPDATE user SET phone=?, role=?, updated_at=? WHERE user.id = ?]
[parameters: ('17696021213', None, '2024-06-27 04:15:38.124468', 1)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-06-28 07:52:05,549 - ERROR - __init__:22 - cannot unpack non-iterable NoneType object
2024-06-28 08:04:28,856 - ERROR - __init__:22 - cannot unpack non-iterable NoneType object
2024-06-28 08:04:52,919 - ERROR - __init__:22 - cannot unpack non-iterable NoneType object
2024-06-28 08:06:47,390 - ERROR - app:838 - Exception on /admin/users/3/send_gift [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/jwt_required.py", line 15, in wrapper
    return fn(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/admin/user.py", line 81, in send_gift_view
    errors = send_gift(user_id, json_data)
  File "/workspaces/red-crawler/app/controllers/admin/user_controller.py", line 62, in send_gift
    start_at, end_at = None
TypeError: cannot unpack non-iterable NoneType object
2024-06-28 08:36:41,988 - ERROR - __init__:22 - 404 Not Found: 用户不存在
2024-06-28 09:23:27,561 - ERROR - __init__:22 - 404 Not Found: 用户不存在
2024-07-01 02:52:49,795 - ERROR - app:838 - Exception on /admin/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/jwt_required.py", line 15, in wrapper
    return fn(*args, **kwargs)
TypeError: paginator.<locals>.decorator() missing 1 required positional argument: 'func'
2024-07-01 02:53:27,786 - ERROR - __init__:22 - Object of type Query is not JSON serializable
2024-07-01 02:53:27,786 - ERROR - app:838 - Exception on /admin/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/jwt_required.py", line 15, in wrapper
    return fn(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 46, in wrapper
    paginated_query = query.paginate(page=page, per_page=per_page, error_out=False)
AttributeError: 'Response' object has no attribute 'paginate'
2024-07-01 02:58:49,648 - ERROR - __init__:22 - Object of type Query is not JSON serializable
2024-07-01 02:58:49,648 - ERROR - app:838 - Exception on /admin/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/jwt_required.py", line 15, in wrapper
    return fn(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 46, in wrapper
    paginated_query = query.paginate(page=page, per_page=per_page, error_out=False)
AttributeError: 'Response' object has no attribute 'paginate'
2024-07-01 03:05:55,040 - ERROR - __init__:22 - `Nested` fields must be passed a `Schema`, not <class 'type'>.
2024-07-01 03:16:12,357 - ERROR - __init__:22 - Only '=', '!=', 'is_()', 'is_not()', 'is_distinct_from()', 'is_not_distinct_from()' operators can be used with None/True/False
2024-07-01 06:29:53,299 - ERROR - app:838 - Exception on /admin/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 46, in login_view
    user = login(form.phone.data, form.password.data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 28, in login
    if user and user.check_password(password):
  File "/workspaces/red-crawler/app/models/user.py", line 18, in check_password
    return check_password_hash(self.password_hash, password)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/werkzeug/security.py", line 128, in check_password_hash
    return hmac.compare_digest(_hash_internal(method, salt, password)[0], hashval)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/werkzeug/security.py", line 28, in _hash_internal
    password_bytes = password.encode()
AttributeError: 'int' object has no attribute 'encode'
2024-07-01 06:53:03,146 - ERROR - __init__:22 - 'int' object has no attribute 'days'
2024-07-01 06:54:54,553 - ERROR - __init__:22 - unsupported operand type(s) for +: 'builtin_function_or_method' and 'datetime.timedelta'
2024-07-01 08:29:05,453 - ERROR - app:838 - Exception on /api/properties [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 167, in decorator
    verify_jwt_in_request(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 113, in verify_jwt_in_request
    g._jwt_extended_jwt_user = _load_user(jwt_header, jwt_data)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 182, in _load_user
    user = user_lookup(jwt_header, jwt_data)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/internal_utils.py", line 44, in user_lookup
    return jwt_manager._user_lookup_callback and jwt_manager._user_lookup_callback(
TypeError: user_loader() takes 1 positional argument but 2 were given
2024-07-01 09:30:06,434 - ERROR - __init__:22 - 'function' object has no attribute 'paginate'
2024-07-01 09:30:44,129 - ERROR - __init__:22 - Object of type LocalProxy is not JSON serializable
2024-07-01 09:31:28,234 - ERROR - app:838 - Exception on /api/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 49, in login_view
    access_token = get_user_jwt(user_schema(user))  # 假设get_user_jwt接受用户
TypeError: 'UserSchema' object is not callable
2024-07-01 09:32:37,983 - ERROR - app:838 - Exception on /api/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 49, in login_view
    u = user_schema(user)
TypeError: 'UserSchema' object is not callable
2024-07-01 09:33:08,034 - ERROR - app:838 - Exception on /api/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 50, in login_view
    access_token = get_user_jwt(u)  # 假设get_user_jwt接受用户
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 13, in get_user_jwt
    access_token = create_access_token(identity=user, expires_delta=timedelta(hours=2))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/utils.py", line 175, in create_access_token
    return jwt_manager._encode_jwt_from_config(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/jwt_manager.py", line 505, in _encode_jwt_from_config
    claim_overrides = self._user_claims_callback(identity)
  File "/workspaces/red-crawler/app/jwt_callbacks.py", line 7, in add_claims_to_access_token
    user = User.query.get(identity)
  File "<string>", line 2, in get
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/deprecations.py", line 386, in warned
    return fn(*args, **kwargs)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 1127, in get
    return self._get_impl(ident, loading.load_on_pk_identity)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 1136, in _get_impl
    return self.session._get_impl(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 3783, in _get_impl
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Incorrect number of values in identifier to formulate primary key for session.get(); primary key columns are 'user.id'
2024-07-01 09:35:44,617 - ERROR - app:838 - Exception on /api/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 50, in login_view
    access_token = get_user_jwt(u)  # 假设get_user_jwt接受用户
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 13, in get_user_jwt
    access_token = create_access_token(identity=user, expires_delta=timedelta(hours=2))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/utils.py", line 175, in create_access_token
    return jwt_manager._encode_jwt_from_config(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/jwt_manager.py", line 523, in _encode_jwt_from_config
    identity=self._user_identity_callback(identity),
  File "/workspaces/red-crawler/app/jwt_callbacks.py", line 13, in user_identity_lookup
    return user.id
AttributeError: 'dict' object has no attribute 'id'
2024-07-01 09:39:55,886 - ERROR - __init__:22 - Object of type LocalProxy is not JSON serializable
2024-07-01 09:51:20,596 - ERROR - __init__:22 - Object of type LocalProxy is not JSON serializable
2024-07-01 09:52:42,744 - ERROR - __init__:22 - 'function' object has no attribute 'id'
2024-07-01 09:57:04,186 - ERROR - __init__:22 - Object of type LocalProxy is not JSON serializable
2024-07-01 09:58:03,008 - INFO - property:15 - <User 2>
2024-07-01 09:58:29,777 - INFO - property:15 - 17696021212
2024-07-01 10:00:22,037 - INFO - property:17 - <User 2>
2024-07-01 10:01:47,092 - INFO - property:18 - <User 2>
2024-07-02 03:03:25,121 - ERROR - app:838 - Exception on /admin/users [GET]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/jwt_required.py", line 9, in wrapper
    claims = get_jwt()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/utils.py", line 29, in get_jwt
    raise RuntimeError(
RuntimeError: You must call `@jwt_required()` or `verify_jwt_in_request()` before using this method
2024-07-02 03:24:30,203 - ERROR - app:838 - Exception on /admin/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlite3.InterfaceError: Error binding parameter 0 - probably unsupported type.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/auth.py", line 49, in login_view
    access_token = get_user_jwt(user)  # 假设get_user_jwt接受用户
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 13, in get_user_jwt
    access_token = create_access_token(identity=user, expires_delta=timedelta(hours=2))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/utils.py", line 175, in create_access_token
    return jwt_manager._encode_jwt_from_config(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/jwt_manager.py", line 505, in _encode_jwt_from_config
    claim_overrides = self._user_claims_callback(identity)
  File "/workspaces/red-crawler/app/jwt_callbacks.py", line 6, in add_claims_to_access_token
    user = User.query.get(identity)
  File "<string>", line 2, in get
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/deprecations.py", line 386, in warned
    return fn(*args, **kwargs)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 1127, in get
    return self._get_impl(ident, loading.load_on_pk_identity)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 1136, in _get_impl
    return self.session._get_impl(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 3862, in _get_impl
    return db_load_fn(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2236, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 293, in orm_execute_statement
    result = conn.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.InterfaceError: (sqlite3.InterfaceError) Error binding parameter 0 - probably unsupported type.
[SQL: SELECT user.id AS user_id, user.phone AS user_phone, user.password_hash AS user_password_hash, user.role AS user_role, user.deleted AS user_deleted, user.created_at AS user_created_at, user.updated_at AS user_updated_at 
FROM user 
WHERE user.id = ?]
[parameters: (<User 3>,)]
(Background on this error at: https://sqlalche.me/e/20/rvf5)
2024-07-02 03:32:04,409 - INFO - jwt_required:10 - {'fresh': False, 'iat': 1719890849, 'jti': '3ad046c9-82a2-43ae-8530-3382c8f4c10e', 'type': 'access', 'sub': 3, 'nbf': 1719890849, 'csrf': 'ddfc89f1-7d69-488b-963c-7ed0ceb3eb38', 'exp': 1719898049, 'role': 'admin'}
2024-07-02 03:32:33,167 - INFO - jwt_required:10 - {'fresh': False, 'iat': 1719890849, 'jti': '3ad046c9-82a2-43ae-8530-3382c8f4c10e', 'type': 'access', 'sub': 3, 'nbf': 1719890849, 'csrf': 'ddfc89f1-7d69-488b-963c-7ed0ceb3eb38', 'exp': 1719898049, 'role': 'admin'}
2024-07-02 03:32:38,974 - INFO - jwt_required:10 - {'fresh': False, 'iat': 1719890849, 'jti': '3ad046c9-82a2-43ae-8530-3382c8f4c10e', 'type': 'access', 'sub': 3, 'nbf': 1719890849, 'csrf': 'ddfc89f1-7d69-488b-963c-7ed0ceb3eb38', 'exp': 1719898049, 'role': 'admin'}
2024-07-03 02:40:40,937 - ERROR - app:838 - Exception on /admin/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 883, in full_dispatch_request
    return self.finalize_request(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 902, in finalize_request
    response = self.make_response(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1193, in make_response
    rv = self.json.response(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
TypeError: '<' not supported between instances of 'User' and 'str'
2024-07-03 02:43:30,584 - INFO - auth:39 - None
2024-07-03 02:43:30,584 - INFO - auth:40 - {'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcxOTk3NDYxMCwianRpIjoiMjFmOTUxMTctNWQ5Mi00NWM3LTk4YzUtOTZjMjhiMzVjOTM3IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MywibmJmIjoxNzE5OTc0NjEwLCJjc3JmIjoiMjQ2ZjI3YmUtNzRkZS00OWZjLTgwOTQtZDVjYWM5M2JlYTI2IiwiZXhwIjoxNzE5OTgxODEwLCJyb2xlIjoiYWRtaW4ifQ.I6np__DrfeOLp8qyw7hmSkvnq74qjiFdzvZ4U6LlZ5A': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcxOTk3NDYxMCwianRpIjoiMjFmOTUxMTctNWQ5Mi00NWM3LTk4YzUtOTZjMjhiMzVjOTM3IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MywibmJmIjoxNzE5OTc0NjEwLCJjc3JmIjoiMjQ2ZjI3YmUtNzRkZS00OWZjLTgwOTQtZDVjYWM5M2JlYTI2IiwiZXhwIjoxNzE5OTgxODEwLCJyb2xlIjoiYWRtaW4ifQ.I6np__DrfeOLp8qyw7hmSkvnq74qjiFdzvZ4U6LlZ5A', <User 3>: {'id': 3, 'phone': '17696021211', 'role': 'admin', 'deleted': False, 'created_at': '2024-06-27T04:20:53.539191', 'updated_at': '2024-07-03T02:43:24.334968'}}
2024-07-03 02:43:30,585 - ERROR - app:838 - Exception on /admin/login [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 883, in full_dispatch_request
    return self.finalize_request(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 902, in finalize_request
    response = self.make_response(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1193, in make_response
    rv = self.json.response(rv)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 214, in response
    f"{self.dumps(obj, **dump_args)}\n", mimetype=self.mimetype
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/json/provider.py", line 179, in dumps
    return json.dumps(obj, **kwargs)
  File "/usr/local/python/3.10.13/lib/python3.10/json/__init__.py", line 238, in dumps
    **kw).encode(obj)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
  File "/usr/local/python/3.10.13/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
TypeError: '<' not supported between instances of 'User' and 'str'
2024-07-03 02:44:29,396 - INFO - auth:39 - None
2024-07-03 02:44:29,397 - INFO - auth:40 - {'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcxOTk3NDY2OSwianRpIjoiNmIxOTQ2YmEtYmY3NC00MmRiLTg3ODEtNjI2NGI5YjgyZjNlIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MywibmJmIjoxNzE5OTc0NjY5LCJjc3JmIjoiOTFhYjcxZDktZTUzYy00N2E1LWEwZTgtOWY3YzA5ZWQ5NWM1IiwiZXhwIjoxNzE5OTgxODY5LCJyb2xlIjoiYWRtaW4ifQ.B9amd_GwuL0S6CfdSjG9KqOAvMji-JCJvwIPgxQKKvM', 'user': {'id': 3, 'phone': '17696021211', 'role': 'admin', 'deleted': False, 'created_at': '2024-06-27T04:20:53.539191', 'updated_at': '2024-07-03T02:44:23.341994'}}
2024-07-03 02:46:13,782 - ERROR - __init__:22 - 401 Unauthorized: 用户名或密码错误
2024-07-03 02:46:33,403 - INFO - auth:41 - None
2024-07-03 02:46:33,404 - INFO - auth:42 - {'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcxOTk3NDc5MywianRpIjoiOGI4MDQ0MWYtODFkOC00NTE5LWIxYzgtMmM0ZmVlMzVlNzk5IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MywibmJmIjoxNzE5OTc0NzkzLCJjc3JmIjoiMmFlM2IwODctMDA0OS00NTlmLWJmZTAtZDBiNjY5Y2U5ZmM1IiwiZXhwIjoxNzE5OTgxOTkzLCJyb2xlIjoiYWRtaW4ifQ.5CYPOY0ANpULWODy_2HhuG8rkyYrv0j93BvWp7kZUG0', 'user': {'id': 3, 'phone': '17696021211', 'role': 'admin', 'deleted': False, 'created_at': '2024-06-27T04:20:53.539191', 'updated_at': '2024-07-03T02:45:59.703969'}}
2024-07-03 02:47:32,581 - INFO - auth:41 - None
2024-07-03 02:47:32,582 - INFO - auth:42 - {'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcxOTk3NDg1MiwianRpIjoiM2JlNGZhNTItMTg2MS00MGE5LTljNmItZmExYzZhNjY4NWNlIiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MiwibmJmIjoxNzE5OTc0ODUyLCJjc3JmIjoiMjUxYzUyY2YtOTI1Mi00Mzk3LTk5NjctM2I1MGVhZDE3ZTM1IiwiZXhwIjoxNzE5OTgyMDUyLCJyb2xlIjoidXNlciJ9.B-KloYlxUJ5OF6czfqX5SvrI_-ebN5ZtAN55UxmXC5o', 'user': {'id': 2, 'phone': '17696021212', 'role': 'user', 'deleted': False, 'created_at': '2024-06-26T07:46:49.759424', 'updated_at': '2024-06-26T07:46:49.759429'}}
2024-07-03 02:47:43,011 - INFO - auth:41 - None
2024-07-03 02:47:43,012 - INFO - auth:42 - {'access_token': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJmcmVzaCI6ZmFsc2UsImlhdCI6MTcxOTk3NDg2MywianRpIjoiMjQ1NTVmZGYtM2ExMS00NGFhLTk5MzYtZmY4YjNiNWViMGY0IiwidHlwZSI6ImFjY2VzcyIsInN1YiI6MywibmJmIjoxNzE5OTc0ODYzLCJjc3JmIjoiMWExN2VlNTktMGQ0MC00NTY3LWJkNGQtYjhmNGVmYjU2NjY5IiwiZXhwIjoxNzE5OTgyMDYzLCJyb2xlIjoiYWRtaW4ifQ.UQqAxAn4OTdeHlnZ0hCA0Rb91XAV5WVb9QrH6J__hPQ', 'user': {'id': 3, 'phone': '17696021211', 'role': 'admin', 'deleted': False, 'created_at': '2024-06-27T04:20:53.539191', 'updated_at': '2024-07-03T02:45:59.703969'}}
2024-07-03 03:13:24,470 - ERROR - __init__:22 - 401 Unauthorized: 用户名或密码错误
2024-07-04 05:55:44,297 - INFO - auth:40 - {'phone': '17696021212', 'password': '11111111'}
2024-07-08 05:59:40,048 - ERROR - __init__:22 - local variable 'json_data' referenced before assignment
2024-07-08 06:08:36,706 - ERROR - __init__:22 - 404 Not Found: api路径不存在
2024-07-08 06:10:41,813 - ERROR - __init__:22 - Entity namespace for "property" has no property "uesr_id"
2024-07-08 06:13:43,353 - ERROR - __init__:22 - 'list' object has no attribute 'paginate'
2024-07-08 06:26:51,785 - ERROR - __init__:22 - Query.get() being called on a Query with existing criterion. 
2024-07-08 06:29:01,281 - ERROR - __init__:22 - 404 Not Found: 资产不存在
2024-07-08 06:29:43,484 - ERROR - __init__:22 - 409 Conflict: 手机号已存在，请更换手机号重试
2024-07-08 06:31:09,700 - ERROR - __init__:22 - 409 Conflict: 手机号已存在，请更换手机号重试
2024-07-08 06:36:10,415 - ERROR - __init__:22 - (sqlite3.IntegrityError) UNIQUE constraint failed: user.phone
[SQL: UPDATE user SET phone=?, role=?, deleted=?, updated_at=? WHERE user.id = ?]
[parameters: ('17696021213', 'admin', 1, '2024-07-08 06:36:10.415082', 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-07-08 06:42:09,055 - ERROR - __init__:22 - (sqlite3.IntegrityError) NOT NULL constraint failed: user.phone
[SQL: UPDATE user SET phone=?, role=?, updated_at=? WHERE user.id = ?]
[parameters: (None, 'user', '2024-07-08 06:42:09.054739', 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-07-08 06:43:48,974 - ERROR - __init__:22 - (sqlite3.IntegrityError) NOT NULL constraint failed: user.phone
[SQL: UPDATE user SET phone=?, role=?, deleted=?, updated_at=? WHERE user.id = ?]
[parameters: (None, 'user', 0, '2024-07-08 06:43:48.974636', 2)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
2024-07-11 06:21:06,600 - ERROR - __init__:22 - 401 Unauthorized: 用户名或密码错误
2024-07-11 06:21:28,081 - ERROR - __init__:22 - 401 Unauthorized: 用户名或密码错误
2024-07-11 06:21:51,849 - ERROR - __init__:22 - 404 Not Found: 资产不存在
2024-07-11 07:15:36,542 - ERROR - __init__:22 - '>' not supported between instances of 'str' and 'datetime.datetime'
2024-07-15 07:24:54,079 - ERROR - __init__:22 - '>' not supported between instances of 'str' and 'datetime.datetime'
2024-07-24 06:39:39,179 - ERROR - __init__:22 - Query.get() being called on a Query with existing criterion. 
2024-07-24 06:42:35,901 - ERROR - __init__:22 - Query.get() being called on a Query with existing criterion. 
2024-07-24 06:43:38,862 - ERROR - __init__:22 - 404 Not Found: 邀请码不存在
2024-07-24 08:43:22,050 - ERROR - __init__:22 - Boolean value of this clause is not defined
2024-07-24 08:54:32,045 - ERROR - app:838 - Exception on /api/invite_codes [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/api/invite_code.py", line 21, in create_invite_codes_view
    invite_code = InviteCode.gene_invite_code(current_user.id)
  File "/workspaces/red-crawler/app/models/invite_code.py", line 23, in gene_invite_code
    if InviteCode.query.filter(InviteCode.code == invite_code.code).exists():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 748, in __bool__
    raise TypeError("Boolean value of this clause is not defined")
TypeError: Boolean value of this clause is not defined

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-24 08:58:05,555 - ERROR - app:838 - Exception on /api/invite_codes [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/api/invite_code.py", line 25, in create_invite_codes_view
    raise Exception("邀请码创建失败")
Exception: 邀请码创建失败

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-24 08:59:48,841 - ERROR - app:838 - Exception on /api/invite_codes/3 [GET]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/api/invite_code.py", line 33, in invite_code_view
    raise NotFound("邀请码不存在")
werkzeug.exceptions.NotFound: 404 Not Found: 邀请码不存在

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-24 09:14:30,115 - ERROR - __init__:22 - 404 Not Found: 邀请码不存在
2024-07-24 09:17:56,122 - ERROR - __init__:22 - scoped_session.begin() got an unexpected keyword argument 'subtransactions'
2024-07-24 09:19:02,472 - ERROR - __init__:22 - Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.
2024-07-24 09:20:05,785 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 19, in register_view
    errors, res = register(json_data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 35, in register
    new_user.invite_code_code = invite_code.code
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 566, in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1086, in get
    value = self._fire_loader_callables(state, key, passive)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/attributes.py", line 1116, in _fire_loader_callables
    return state._load_expired(state, passive)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state.py", line 803, in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/loading.py", line 1670, in load_scalar_attributes
    result = load_on_ident(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/loading.py", line 509, in load_on_ident
    return load_on_pk_identity(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/loading.py", line 694, in load_on_pk_identity
    session.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2351, in execute
    return self._execute_internal(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2226, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2090, in _connection_for_bind
    TransactionalContext._trans_ctx_check(self)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/util.py", line 111, in _trans_ctx_check
    raise exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Can't operate on closed transaction inside context manager.  Please complete the context manager before emitting further commands.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-24 09:25:42,923 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 19, in register_view
    errors, res = register(json_data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 27, in register
    with db.session.begin():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 443, in begin
    return self._proxied.begin(nested=nested)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1928, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 07:04:17,714 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 20, in register_view
    errors, res = register(json_data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 25, in register
    with db.session.begin():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 443, in begin
    return self._proxied.begin(nested=nested)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1928, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 07:09:37,302 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: NOT NULL constraint failed: invite_code.owner_id

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 20, in register_view
    errors, res = register(json_data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 22, in register
    with db.session.begin():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/util.py", line 147, in __exit__
    with util.safe_reraise():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/util.py", line 145, in __exit__
    self.commit()
  File "<string>", line 2, in commit
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: invite_code.owner_id
[SQL: INSERT INTO invite_code (code, pieces, deleted, created_at, updated_at, owner_id) VALUES (?, ?, ?, ?, ?, ?)]
[parameters: ('VCuJk0', 3, 0, '2024-07-25 07:09:37.301599', '2024-07-25 07:09:37.301602', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 07:23:26,855 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: NOT NULL constraint failed: invite_code.owner_id

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 20, in register_view
    errors, res = register(json_data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 22, in register
    with db.session.begin(nested=True):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/util.py", line 147, in __exit__
    with util.safe_reraise():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/util.py", line 145, in __exit__
    self.commit()
  File "<string>", line 2, in commit
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1302, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1277, in _prepare_impl
    self.session.flush()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4341, in flush
    self._flush(objects)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4476, in _flush
    with util.safe_reraise():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 4437, in _flush
    flush_context.execute()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 93, in save_obj
    _emit_insert_statements(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/persistence.py", line 1233, in _emit_insert_statements
    result = connection.execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2353, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 924, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) NOT NULL constraint failed: invite_code.owner_id
[SQL: INSERT INTO invite_code (code, pieces, deleted, created_at, updated_at, owner_id) VALUES (?, ?, ?, ?, ?, ?)]
[parameters: ('7BSAIg', 3, 0, '2024-07-25 07:23:26.854753', '2024-07-25 07:23:26.854755', None)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 07:31:36,809 - ERROR - app:838 - Exception on /api/register [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 20, in register_view
    errors, res = register(json_data)
  File "/workspaces/red-crawler/app/controllers/auth_controller.py", line 24, in register
    raise Conflict("手机号已存在，请更换手机号重试")
werkzeug.exceptions.Conflict: 409 Conflict: 手机号已存在，请更换手机号重试

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 07:32:37,394 - ERROR - __init__:22 - 409 Conflict: 手机号已存在，请更换手机号重试
2024-07-25 07:38:18,980 - ERROR - app:838 - Exception on /api/logout [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
TypeError: jwt_required.<locals>.wrapper() got an unexpected keyword argument 'prefix'
2024-07-25 07:39:06,109 - ERROR - app:838 - Exception on /api/logout [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
TypeError: jwt_required.<locals>.wrapper() got an unexpected keyword argument 'prefix'
2024-07-25 07:41:11,615 - ERROR - app:838 - Exception on /api/logout [POST]
Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
TypeError: jwt_required.<locals>.wrapper() got an unexpected keyword argument 'prefix'
2024-07-25 07:41:56,100 - ERROR - __init__:22 - A transaction is already begun on this Session.
2024-07-25 07:42:47,513 - ERROR - __init__:22 - A transaction is already begun on this Session.
2024-07-25 07:43:18,468 - ERROR - __init__:22 - A transaction is already begun on this Session.
2024-07-25 07:44:15,685 - ERROR - app:838 - Exception on /api/logout [POST]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/auth.py", line 59, in logout_view
    with db.session.begin():
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/scoping.py", line 443, in begin
    return self._proxied.begin(nested=nested)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 1928, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 170, in decorator
    return current_app.ensure_sync(fn)(*args, **kwargs)
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 08:00:29,943 - ERROR - app:838 - Exception on /api/properties [GET]
Traceback (most recent call last):
  File "/workspaces/red-crawler/app/views/__init__.py", line 11, in wrapper
    result = func(*args, **kwargs)
  File "/workspaces/red-crawler/app/jwt_callbacks.py", line 36, in check_if_token_in_blacklist
    raise Unauthorized("登录失效，请重新登录")
werkzeug.exceptions.Unauthorized: 401 Unauthorized: 登录失效，请重新登录

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 1473, in wsgi_app
    response = self.full_dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 882, in full_dispatch_request
    rv = self.handle_user_exception(e)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_cors/extension.py", line 178, in wrapped_function
    return cors_after_request(app.make_response(f(*args, **kwargs)))
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 880, in full_dispatch_request
    rv = self.dispatch_request()
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask/app.py", line 865, in dispatch_request
    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 167, in decorator
    verify_jwt_in_request(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 94, in verify_jwt_in_request
    jwt_data, jwt_header, jwt_location = _decode_jwt_from_request(
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/view_decorators.py", line 368, in _decode_jwt_from_request
    verify_token_not_blocklisted(jwt_header, decoded_token)
  File "/usr/local/python/3.10.13/lib/python3.10/site-packages/flask_jwt_extended/internal_utils.py", line 58, in verify_token_not_blocklisted
    if jwt_manager._token_in_blocklist_callback(jwt_header, jwt_data):
  File "/workspaces/red-crawler/app/views/__init__.py", line 22, in wrapper
    current_app.logger.error(e.with_traceback())
TypeError: BaseException.with_traceback() takes exactly one argument (0 given)
2024-07-25 08:01:03,476 - ERROR - __init__:22 - 401 Unauthorized: 登录失效，请重新登录
2024-07-25 08:02:37,729 - ERROR - __init__:22 - Object of type Response is not JSON serializable
2024-07-25 08:08:00,572 - ERROR - __init__:22 - 404 Not Found: 邀请码不存在
2024-07-25 08:09:37,949 - ERROR - __init__:22 - fromisoformat: argument must be str
2024-09-29 07:42:32,144 - ERROR - __init__:22 - 400 Bad Request: The browser (or proxy) sent a request that this server could not understand.
2024-09-29 07:44:09,021 - ERROR - __init__:22 - RevokedToken.is_token_blacklisted() missing 1 required positional argument: 'cls'
2024-09-29 07:46:25,692 - ERROR - __init__:22 - 404 Not Found: 缺少refresh_token信息
2024-09-29 07:47:08,726 - ERROR - __init__:22 - 400 Bad Request: The browser (or proxy) sent a request that this server could not understand.
2024-09-29 07:47:31,584 - ERROR - __init__:22 - 400 Bad Request: refresh_token已经失效
2024-09-29 07:48:58,265 - ERROR - __init__:22 - 400 Bad Request: refresh_token已经失效
